<!-- https://lee0721.github.io/html5/w3c.HTML -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>用JavaScript套件開啟手機鏡頭進行拍照、錄影</title> 
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:image:alt" content="用JavaScript套件開啟手機鏡頭進行拍照、錄影"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.min.css" media="screen"/>
    <link rel="stylesheet" href="dist/style.min.css" media="screen"/>
</head>
<body>
    <div class="container" id="app">
        <div class="title">
            <h1>用JavaScript套件開啟手機鏡頭進行拍照、錄影</h1>
        </div>
        <hr/>
        <h3>W3C MediaStream API：</h3>
        <ul>
            <li>透過 JavaScript 訪問媒體設備，例如相機和麥克風</li>
            <li>需要使用 navigator.mediaDevices 對象</li>
            <li>可以通過這種方式捕捉相機畫面並將其轉換為圖像</li>
        </ul>
        <hr/>
        <h1>Camera Photo and Video Recording Example</h1>
    
    <!-- 示例1: 前鏡頭 - 開始相機 -->
    <h2>示例1: 前鏡頭 - 開始相機</h2>
    <p><button id="startCamera">Start Camera</button></p>

    <!-- 示例1 结果显示 -->
    <p>顯示結果：</p>
    <video id="video" autoplay></video>

    <!-- 示例2: 前鏡頭 - 拍照 -->
    <h2>示例2: 前鏡頭 - 拍照</h2>
    <p><button id="takePhoto" disabled>Take Photo</button></p>

    <!-- 示例2 结果显示 -->
    <p>顯示結果：</p>
    <canvas id="canvas" style="display: none;"></canvas>

    <!-- 示例3: 前鏡頭 - 開始錄影 -->
    <h2>示例3: 前鏡頭 - 開始錄影</h2>
    <p><button id="startRecording" disabled>Start Recording</button></p>

    <!-- 示例3 结果显示 -->
    <p>顯示結果：</p>
    <p><button id="stopRecording" disabled>Stop Recording</button></p>

    <!-- 示例3 结果显示 -->
    <p>顯示結果：</p>
    <textarea class="hidden" id="videoUserFileResult" disabled="disabled"></textarea>
    <video class="hidden" id="videoUserFileVideo" controls="controls"></video>


    <script>
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('canvas');
        const startCameraButton = document.getElementById('startCamera');
        const takePhotoButton = document.getElementById('takePhoto');
        const startRecordingButton = document.getElementById('startRecording');
        const stopRecordingButton = document.getElementById('stopRecording');
        let mediaStream;

        // Start the camera
        startCameraButton.addEventListener('click', async () => {
            try {
                mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = mediaStream;
                takePhotoButton.disabled = false;
                startRecordingButton.disabled = false;
            } catch (error) {
                console.error('Failed to get camera access:', error);
            }
        });

        // Take a photo
        takePhotoButton.addEventListener('click', () => {
            canvasElement.width = videoElement.videoWidth;
            canvasElement.height = videoElement.videoHeight;
            canvasElement.getContext('2d').drawImage(videoElement, 0, 0);
            const photoDataUrl = canvasElement.toDataURL('image/jpeg');
            // You can send the captured photo data to a server or display it on the page here
            console.log('Photo Data:', photoDataUrl);
        });

        let mediaRecorder;
        let recordedChunks = [];

        // Start recording video
        startRecordingButton.addEventListener('click', () => {
            mediaRecorder = new MediaRecorder(mediaStream);
            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };
            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const videoUrl = window.URL.createObjectURL(blob);
                // You can send the recorded video data to a server or display it on the page here
                console.log('Recorded Video URL:', videoUrl);
            };
            mediaRecorder.start();
            stopRecordingButton.disabled = false;
            startRecordingButton.disabled = true;
        });

        // Stop recording video
        stopRecordingButton.addEventListener('click', () => {
            mediaRecorder.stop();
            stopRecordingButton.disabled = true;
            startRecordingButton.disabled = false;
        });
    </script>
</body>
</html>
